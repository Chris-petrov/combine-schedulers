<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CombineSchedulers - TestScheduler</title>
    <link rel="stylesheet" type="text/css" href="/combine-schedulers/all.css" media="all" />
</head>
<body>
    <header>
        <a href="/combine-schedulers/">
            <strong>
                CombineSchedulers
            </strong>
            <span>Documentation</span>
        </a>
    </header>

    <!--
    <form class="search">
        <input type="search" placeholder="Search" />
    </form>
    -->

    <nav>
        <div class="wrapper">
            <h2>On This Page</h2>
            <ol><li><a href="#relationships">Relationships</a><ul><li><a href="#relationships">Conforms To</a></li></ul></li><li><a href="#initializers">Initializers</a><ul><li class="initializer"><a href="#testscheduler.init(now:)">init(now:​)</a></li></ul></li><li><a href="#properties">Properties</a><ul><li class="variable"><a href="#testscheduler.minimumtolerance">minimum​Tolerance</a></li><li class="variable"><a href="#testscheduler.now">now</a></li></ul></li><li><a href="#methods">Methods</a><ul><li class="function"><a href="#testscheduler.advance(by:)">advance(by:​)</a></li><li class="function"><a href="#testscheduler.run()">run()</a></li><li class="function"><a href="#testscheduler.schedule(after:interval:tolerance:options:_:)">schedule(after:​interval:​tolerance:​options:​_:​)</a></li><li class="function"><a href="#testscheduler.schedule(after:tolerance:options:_:)">schedule(after:​tolerance:​options:​_:​)</a></li><li class="function"><a href="#testscheduler.schedule(options:_:)">schedule(options:​_:​)</a></li></ul></li></ol>
        </div>
    </nav>

    <main>
        <article>
            <h1>
    <small>Class</small>
    <code class="name">Test​Scheduler</code>
</h1>

<div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="attribute">final</span> <span class="keyword">class</span> <span class="type">TestScheduler</span>&lt;<span class="variable">SchedulerTimeType</span>, <span class="variable">SchedulerOptions</span>&gt;: <span class="type">Scheduler</span>
<span class="keyword">where</span> <span class="type">SchedulerTimeType</span>: <span class="type">Strideable</span>, <span class="type">SchedulerTimeType</span>.<span class="type">Stride</span>: <span class="type">SchedulerTimeIntervalConvertible</span>  </body></html></code></pre>
</div>
<div class="summary" role="doc-abstract">
    <p>A scheduler whose current time and execution can be controlled in a deterministic manner.</p>

</div>
<div class="discussion">
    <p>This scheduler is useful for testing how the flow of time effects publishers that use
asynchronous operators, such as <code>debounce</code>, <code>throttle</code>, <code>delay</code>, <code>timeout</code>, <code>receive(on:)</code>,
<code>subscribe(on:)</code> and more.</p>

<p>For example, consider the following <code>race</code> operator that runs two futures in parallel, but
only emits the first one that completes:</p>

<html><body><pre class="highlight"><code><span class="keyword">func</span> <span class="function">race</span>&lt;<span class="variable">Output</span>, <span class="variable">Failure</span>: <span class="type">Error</span>&gt;(
  <span class="keyword">_</span> <span class="variable">first</span>: <span class="type">Future</span>&lt;<span class="type">Output</span>, <span class="type">Failure</span>&gt;,
  <span class="keyword">_</span> <span class="variable">second</span>: <span class="type">Future</span>&lt;<span class="type">Output</span>, <span class="type">Failure</span>&gt;
) -&gt; <span class="type">AnyPublisher</span>&lt;<span class="type">Output</span>, <span class="type">Failure</span>&gt; {
  <span class="variable">first</span>
    .<span class="variable">merge</span>(<span class="variable">with</span>: <span class="type">second</span>)
    .<span class="variable">prefix</span>(<span class="number literal">1</span>)
    .<span class="variable">eraseToAnyPublisher</span>()
}
</code></pre></body></html>
<p>Although this publisher is quite simple we may still want to write some tests for it.</p>

<p>To do this we can create a test scheduler and create two futures, one that emits after a
second and one that emits after two seconds:</p>

<html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">scheduler</span> = <span class="variable">DispatchQueue</span>.<span class="variable">test</span>
<span class="keyword">let</span> <span class="variable">first</span> = <span class="variable">Future</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt; { <span class="variable">callback</span> <span class="keyword">in</span>
  <span class="variable">scheduler</span>.<span class="variable">schedule</span>(<span class="variable">after</span>: <span class="type">scheduler</span>.<span class="variable">now</span>.<span class="variable">advanced</span>(<span class="variable">by</span>: <span class="number literal">1</span>)) { <span class="variable">callback</span>(.<span class="variable">success</span>(<span class="number literal">1</span>)) }
}
<span class="keyword">let</span> <span class="variable">second</span> = <span class="variable">Future</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt; { <span class="variable">callback</span> <span class="keyword">in</span>
  <span class="variable">scheduler</span>.<span class="variable">schedule</span>(<span class="variable">after</span>: <span class="type">scheduler</span>.<span class="variable">now</span>.<span class="variable">advanced</span>(<span class="variable">by</span>: <span class="number literal">2</span>)) { <span class="variable">callback</span>(.<span class="variable">success</span>(<span class="number literal">2</span>)) }
}
</code></pre></body></html>
<p>And then we can race these futures and collect their emissions into an array:</p>

<html><body><pre class="highlight"><code><span class="keyword">var</span> <span class="variable">output</span>: [<span class="type">Int</span>] = []
<span class="keyword">let</span> <span class="variable">cancellable</span> = <span class="variable">race</span>(<span class="variable">first</span>, <span class="variable">second</span>).<span class="variable">sink</span> { <span class="variable">output</span>.<span class="variable">append</span>(<span class="variable">$0</span>) }
</code></pre></body></html>
<p>And then we can deterministically move time forward in the scheduler to see how the publisher
emits. We can start by moving time forward by one second:</p>

<html><body><pre class="highlight"><code><span class="variable">scheduler</span>.<span class="variable">advance</span>(<span class="variable">by</span>: <span class="number literal">1</span>)
<span class="variable">XCTAssertEqual</span>(<span class="variable">output</span>, [<span class="number literal">1</span>])
</code></pre></body></html>
<p>This proves that we get the first emission from the publisher since one second of time has
passed. If we further advance by one more second we can prove that we do not get anymore
emissions:</p>

<html><body><pre class="highlight"><code><span class="variable">scheduler</span>.<span class="variable">advance</span>(<span class="variable">by</span>: <span class="number literal">1</span>)
<span class="variable">XCTAssertEqual</span>(<span class="variable">output</span>, [<span class="number literal">1</span>])
</code></pre></body></html>
<p>This is a very simple example of how to control the flow of time with the test scheduler,
but this technique can be used to test any publisher that involves Combine's asynchronous
operations.</p>

</div>
<section id="relationships">
    <h2 hidden>Relationships</h2>
        <figure>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="872pt" height="116pt"
 viewBox="0.00 0.00 872.00 116.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 112)">
<title>%3</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-112 868,-112 868,4 -4,4"/>
<!-- TestScheduler -->
<g id="node1" class="node class current">
<title>TestScheduler</title>
<g id="a_node1"><a xlink:href="/combine-schedulers/TestScheduler" xlink:title="TestScheduler">
<path fill="none" stroke="#000000" stroke-width="3" d="M528,-108C528,-108 336,-108 336,-108 330,-108 324,-102 324,-96 324,-96 324,-84 324,-84 324,-78 330,-72 336,-72 336,-72 528,-72 528,-72 534,-72 540,-78 540,-84 540,-84 540,-96 540,-96 540,-102 534,-108 528,-108"/>
<text text-anchor="middle" x="432" y="-86.3" font-family="Menlo" font-size="14.00" fill="#000000">TestScheduler</text>
</a>
</g>
</g>
<!-- Scheduler -->
<g id="node2" class="node unknown">
<title>Scheduler</title>
<path fill="none" stroke="#000000" d="M528,-36C528,-36 336,-36 336,-36 330,-36 324,-30 324,-24 324,-24 324,-12 324,-12 324,-6 330,0 336,0 336,0 528,0 528,0 534,0 540,-6 540,-12 540,-12 540,-24 540,-24 540,-30 534,-36 528,-36"/>
<text text-anchor="middle" x="432" y="-14.3" font-family="Menlo" font-size="14.00" fill="#000000">Scheduler</text>
</g>
<!-- TestScheduler&#45;&gt;Scheduler -->
<g id="edge1" class="edge conformsTo">
<title>TestScheduler&#45;&gt;Scheduler</title>
<path fill="none" stroke="#000000" d="M432,-71.8314C432,-64.131 432,-54.9743 432,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="435.5001,-46.4132 432,-36.4133 428.5001,-46.4133 435.5001,-46.4132"/>
</g>
</g>
</svg>


    <figcaption hidden>Inheritance graph for TestScheduler.</figcaption>
</figure>
        <h3>Conforms To</h3>
<dl>
    <dt class="unknown"><code>Scheduler</code></dt>
</dl>
</section>
    <section id="initializers">
        <h2>Initializers</h2>

        <div role="article" class="initializer" id="testscheduler.init(now:)">
    <h3>
        <code><a href="#testscheduler.init(now:)">init(now:​)</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">init</span>(<span class="variable">now</span>: <span class="type">SchedulerTimeType</span>)  </body></html></code></pre>
</div>
<div class="summary" role="doc-abstract">
    <p>Creates a test scheduler with the given date.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>now</th>
    <td><code class="type">Scheduler​Time​Type</code></td>
    <td><p>The current date of the test scheduler.</p>
</td>
</tr>
  </tbody>
</table>
</div>
    </section>
    <section id="properties">
        <h2>Properties</h2>

        <div role="article" class="variable" id="testscheduler.minimumtolerance">
    <h3>
        <code><a href="#testscheduler.minimumtolerance">minimum​Tolerance</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">let</span> <span class="variable">minimumTolerance</span>: <span class="type">SchedulerTimeType</span>.<span class="type">Stride</span> = .<span class="variable">zero</span></body></html></code></pre>
</div>
</div>
<div role="article" class="variable" id="testscheduler.now">
    <h3>
        <code><a href="#testscheduler.now">now</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">private</span>(<span class="variable">set</span>) <span class="keyword">var</span> <span class="variable">now</span>: <span class="type">SchedulerTimeType</span></body></html></code></pre>
</div>
</div>
    </section>
    <section id="methods">
        <h2>Methods</h2>

        <div role="article" class="function" id="testscheduler.advance(by:)">
    <h3>
        <code><a href="#testscheduler.advance(by:)">advance(by:​)</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">advance</span>(<span class="variable">by</span> <span class="variable">stride</span>: <span class="type">SchedulerTimeType</span>.<span class="type">Stride</span> = .<span class="variable">zero</span>)  </body></html></code></pre>
</div>
<div class="summary" role="doc-abstract">
    <p>Advances the scheduler by the given stride.</p>

</div>
<h4>Parameters</h4>

<table class="parameters">
  <thead hidden>
  <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
  </tr>
  </thead>
  <tbody>
    <tr>
    <th>stride</th>
    <td><code class="type">Scheduler​Time​Type.​Stride</code></td>
    <td><p>A stride. By default this argument is <code>.zero</code>, which does not advance the scheduler's time but does cause the scheduler to execute any units of work that are waiting to be performed for right now.</p>
</td>
</tr>
  </tbody>
</table>
</div>
<div role="article" class="function" id="testscheduler.run()">
    <h3>
        <code><a href="#testscheduler.run()">run()</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">run</span>()  </body></html></code></pre>
</div>
<div class="summary" role="doc-abstract">
    <p>Runs the scheduler until it has no scheduled items left.</p>

</div>
<div class="discussion">
    <p>This method is useful for proving exhaustively that your publisher eventually completes
and does not run forever. For example, the following code will run an infinite loop forever
because the timer never finishes:</p>

<html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">scheduler</span> = <span class="variable">DispatchQueue</span>.<span class="variable">test</span>
<span class="variable">Publishers</span>.<span class="type">Timer</span>(<span class="variable">every</span>: .<span class="variable">seconds</span>(<span class="number literal">1</span>), <span class="variable">scheduler</span>: <span class="type">scheduler</span>)
  .<span class="variable">autoconnect</span>()
  .<span class="variable">sink</span> { <span class="keyword">_</span> <span class="keyword">in</span> <span class="variable">print</span>(<span class="variable">$0</span>) }
  .<span class="variable">store</span>(<span class="variable">in</span>: &amp;<span class="variable">cancellables</span>)

<span class="variable">scheduler</span>.<span class="variable">run</span>() <span class="comment">// Will never complete</span>
</code></pre></body></html>
<p>If you wanted to make sure that this publisher eventually completes you would need to
chain on another operator that completes it when a certain condition is met. This can be
done in many ways, such as using <code>prefix</code>:</p>

<html><body><pre class="highlight"><code><span class="keyword">let</span> <span class="variable">scheduler</span> = <span class="variable">DispatchQueue</span>.<span class="variable">test</span>
<span class="variable">Publishers</span>.<span class="type">Timer</span>(<span class="variable">every</span>: .<span class="variable">seconds</span>(<span class="number literal">1</span>), <span class="variable">scheduler</span>: <span class="type">scheduler</span>)
  .<span class="variable">autoconnect</span>()
  .<span class="variable">prefix</span>(<span class="number literal">3</span>)
  .<span class="variable">sink</span> { <span class="keyword">_</span> <span class="keyword">in</span> <span class="variable">print</span>(<span class="variable">$0</span>) }
  .<span class="variable">store</span>(<span class="variable">in</span>: &amp;<span class="variable">cancellables</span>)

<span class="variable">scheduler</span>.<span class="variable">run</span>() <span class="comment">// Prints 3 times and completes.</span>
</code></pre></body></html>
</div>
</div>
<div role="article" class="function" id="testscheduler.schedule(after:interval:tolerance:options:_:)">
    <h3>
        <code><a href="#testscheduler.schedule(after:interval:tolerance:options:_:)">schedule(after:​interval:​tolerance:​options:​_:​)</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">schedule</span>(
    <span class="variable">after</span> <span class="variable">date</span>: <span class="type">SchedulerTimeType</span>,
    <span class="variable">interval</span>: <span class="type">SchedulerTimeType</span>.<span class="type">Stride</span>,
    <span class="variable">tolerance</span> <span class="keyword">_</span>: <span class="type">SchedulerTimeType</span>.<span class="type">Stride</span>,
    <span class="variable">options</span> <span class="keyword">_</span>: <span class="type">SchedulerOptions</span>?,
    <span class="keyword">_</span> <span class="variable">action</span>: <span class="attribute">@</span><span class="attribute">escaping</span> () -&gt; <span class="type">Void</span>
  ) -&gt; <span class="type">Cancellable</span>  </body></html></code></pre>
</div>
</div>
<div role="article" class="function" id="testscheduler.schedule(after:tolerance:options:_:)">
    <h3>
        <code><a href="#testscheduler.schedule(after:tolerance:options:_:)">schedule(after:​tolerance:​options:​_:​)</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">schedule</span>(
    <span class="variable">after</span> <span class="variable">date</span>: <span class="type">SchedulerTimeType</span>,
    <span class="variable">tolerance</span> <span class="keyword">_</span>: <span class="type">SchedulerTimeType</span>.<span class="type">Stride</span>,
    <span class="variable">options</span> <span class="keyword">_</span>: <span class="type">SchedulerOptions</span>?,
    <span class="keyword">_</span> <span class="variable">action</span>: <span class="attribute">@</span><span class="attribute">escaping</span> () -&gt; <span class="type">Void</span>
  )  </body></html></code></pre>
</div>
</div>
<div role="article" class="function" id="testscheduler.schedule(options:_:)">
    <h3>
        <code><a href="#testscheduler.schedule(options:_:)">schedule(options:​_:​)</a></code>
    </h3>
    <div class="declaration">
<pre class="highlight"><code><html><body><span class="keyword">public</span> <span class="keyword">func</span> <span class="function">schedule</span>(<span class="variable">options</span> <span class="keyword">_</span>: <span class="type">SchedulerOptions</span>?, <span class="keyword">_</span> <span class="variable">action</span>: <span class="attribute">@</span><span class="attribute">escaping</span> () -&gt; <span class="type">Void</span>)  </body></html></code></pre>
</div>
</div>
    </section>



        </article>
    </main>

    <footer>
        <p>
    Generated on <time datetime="2022-06-28T19:38:46+0000">June 28, 2022</time> using <a href="https://github.com/SwiftDocOrg/swift-doc">swift-doc</a> <span class="version">1.0.0-rc.1</span>.
</p>
    </footer>
</body>
</html>
